<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SeleniumDashboardApp.ViewModels"
             xmlns:converters="clr-namespace:SeleniumDashboardApp.Converters"
             x:Class="SeleniumDashboardApp.Views.MainPage"
             BackgroundColor="White">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StatusColorConverter x:Key="StatusColorConverter" />
            <converters:NullOrEmptyToBoolConverter x:Key="NullOrEmptyToBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">
        <!-- TopBar -->
        <Grid Padding="12" BackgroundColor="#1E1E2E" Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Label Text="Selenium Dashboard"
                   FontSize="22"
                   FontAttributes="Bold"
                   VerticalOptions="Center"
                   TextColor="White" />

            <Button Text="🔍"
                    Grid.Column="1"
                    Clicked="OnToggleSearchClicked"
                    BackgroundColor="Transparent"
                    FontSize="18"
                    TextColor="White" />

            <Button Text="⚙️"
                    Grid.Column="2"
                    Clicked="OnToggleFilterClicked"
                    BackgroundColor="Transparent"
                    FontSize="18"
                    TextColor="White" />
        </Grid>

        <!-- Inhoud -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="20">

                <!-- Zoekveld -->
                <Frame x:Name="SearchEntryFrame" BackgroundColor="#F0F0F0" CornerRadius="8" Padding="0" HasShadow="False" IsVisible="False">
                    <Entry x:Name="SearchEntry"
                           Placeholder="Zoek op project..."
                           Text="{Binding SearchProject, Mode=TwoWay}"
                           TextColor="Black"
                           BackgroundColor="Transparent"
                           HeightRequest="40" />
                </Frame>

                <!-- Status filter (directe ViewModel bindings) -->
                <Frame x:Name="StatusPickerFrame" BackgroundColor="#F0F0F0" CornerRadius="8" Padding="10" HasShadow="False" IsVisible="False" WidthRequest="150" HorizontalOptions="Start">
                    <VerticalStackLayout>
                        <Label Text="Status" FontAttributes="Bold" Margin="0,0,0,10" TextColor="Black" />

                        <RadioButton Content="Passed"
                                     IsChecked="{Binding IsStatusPassedSelected, Mode=TwoWay}"
                                     TextColor="Black" />

                        <RadioButton Content="Failed"
                                     IsChecked="{Binding IsStatusFailedSelected, Mode=TwoWay}"
                                     TextColor="Black" />
                        
                        <Button Text="Reset filter"
                                Command="{Binding ResetFiltersCommand}"
                                BackgroundColor="#DDDDDD"
                                TextColor="Black"
                                CornerRadius="8"
                                Padding="5"
                                FontSize="14"
                                Margin="0,10,0,0" />
                        </VerticalStackLayout>
                </Frame>

                <!-- Actieve status label -->
                <Label x:Name="StatusDisplay"
                       FontSize="14"
                       TextColor="DimGray"
                       IsVisible="{Binding SelectedStatus, Converter={StaticResource NullOrEmptyToBoolConverter}}"
                       Text="{Binding SelectedStatus, StringFormat='Status: {0}'}" />

                <!-- Resultaten -->
                <CollectionView ItemsSource="{Binding TestRuns}" SelectionMode="Single" SelectionChanged="OnTestRunTapped">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="15" Margin="10"
                                   BorderColor="LightGray"
                                   BackgroundColor="#F9F9F9"
                                   CornerRadius="12"
                                   HasShadow="True">
                                <VerticalStackLayout Spacing="5">
                                    <Label Text="{Binding ProjectName}"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           TextColor="Black" />

                                    <Label Text="{Binding Status}"
                                           TextColor="{Binding Status, Converter={StaticResource StatusColorConverter}}" />

                                    <Label Text="{Binding Date}" FontSize="12" TextColor="Gray" />

                                    <Label Text="{Binding Summary}"
                                           LineBreakMode="TailTruncation"
                                           FontSize="14"
                                           TextColor="DimGray" />
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>